"use strict";(()=>{var ie=Object.defineProperty,ae=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var R=(p,a,d)=>a in p?ie(p,a,{enumerable:!0,configurable:!0,writable:!0,value:d}):p[a]=d,y=(p,a)=>{for(var d in a||(a={}))le.call(a,d)&&R(p,d,a[d]);if(W)for(var d of W(a))ue.call(a,d)&&R(p,d,a[d]);return p},v=(p,a)=>ae(p,oe(a));var i=(p,a,d)=>R(p,typeof a!="symbol"?a+"":a,d);var b=(p,a,d)=>new Promise((L,f)=>{var x=g=>{try{m(d.next(g))}catch(w){f(w)}},S=g=>{try{m(d.throw(g))}catch(w){f(w)}},m=g=>g.done?L(g.value):Promise.resolve(g.value).then(x,S);m((d=d.apply(p,a)).next())});function ce(p,a){let d=(a==null?void 0:a.description)||"We value your feedback! Please take a moment to complete our satisfaction survey and help us improve our services.",L=(a==null?void 0:a.questionsPerPage)||1,f=(a==null?void 0:a.defaultCharsLimit)||100,x=(a==null?void 0:a.surveyName)||"Satisfaction survey",S=(a==null?void 0:a.trackSteps)||!0,m=(a==null?void 0:a.validationType)||"disableButtons",g="popup",w={single:"Select one answer",multi:"Select 1 or more questions.",open:"Write your answer:",scale:"Select your answer.",date:"Select your answer."},_=r=>r.classList.add("survey__hidden"),h=r=>r.classList.remove("survey__hidden"),C=r=>new Promise(s=>setTimeout(s,r)),Q=()=>{let r=new Date,s=r.getFullYear(),e=String(r.getMonth()+1).padStart(2,"0"),t=String(r.getDate()).padStart(2,"0");return`${s}-${e}-${t}`},D=r=>r.map(e=>{var t,n,l,c,E,T;return typeof e=="string"||typeof e=="number"?{answer:e,options:{isOpen:!1,limit:f,endsSurvey:!1}}:{answer:e.answer,options:{limit:(n=(t=e.options)==null?void 0:t.limit)!=null?n:f,isOpen:(c=(l=e.options)==null?void 0:l.isOpen)!=null?c:!1,endsSurvey:(T=(E=e.options)==null?void 0:E.endsSurvey)!=null?T:!1}}});function N(r){return r.map(s=>{var t,n,l,c,E;let e=v(y({},s),{required:(t=s.required)!=null?t:!0});switch(s.type){case"date":return v(y({},e),{minDate:"minDate"in s?s.minDate==="today"?Q():s.minDate:"",maxDate:"maxDate"in s?s.maxDate==="today"?Q():s.maxDate:""});case"multi":return v(y({},e),{answers:D(s.answers),shuffleAnswers:(n=s.shuffleAnswers)!=null?n:!1});case"scale":return v(y({},e),{length:(l=s.length)!=null?l:5});case"single":return v(y({},e),{answers:D(s.answers),shuffleAnswers:(c=s.shuffleAnswers)!=null?c:!1});case"open":return v(y({},e),{limit:(E=s.limit)!=null?E:f});default:throw new Error(`Unknown question type: ${e.type}`)}})}let F=r=>r.map(e=>({value:e,sort:Math.random()})).sort((e,t)=>e.sort-t.sort).map(({value:e})=>e),I=N(p),u={totalPages:Math.ceil(I.length/L),currentPage:1,isScrolling:!1};class H{constructor(s,e,t){i(this,"_parentEl");i(this,"_firstChildEl");i(this,"_contentEl");i(this,"_templateEl");i(this,"_templateReplacementData");var n;typeof s=="string"?this._parentEl=document.querySelector(s):this._parentEl=s,this._templateEl=document.getElementById(e),this._firstChildEl=(n=this._templateEl.firstElementChild)==null?void 0:n.cloneNode(!0),this._templateReplacementData=t,t&&this._replaceTemplateStrings(this._templateReplacementData),this._contentEl=this._firstChildEl.firstElementChild,this._render()}_replaceTemplateStrings(s){for(let[e,t]of Object.entries(s)){let n=`**${e}**`;typeof t=="string"||typeof t=="number"?this._firstChildEl.innerHTML=this._firstChildEl.innerHTML.replaceAll(n,t+""):typeof t=="object"&&this._replaceTemplateStrings(t)}}_render(){this._parentEl.insertAdjacentElement("beforeend",this._contentEl)}get contentEl(){return this._contentEl}}class K extends H{constructor(){super(".survey__main-wrapper","survey__template",{surveyDescription:d});i(this,"submitBtn");i(this,"nextBtn");i(this,"previousBtn");i(this,"pagesWrapper");i(this,"visibleQuestions",[]);i(this,"_closeBtnEl");i(this,"_surveyWrapper");i(this,"_formEl");i(this,"_finalViewEl");i(this,"_allQuestionEls",[]);i(this,"_currentPageEl");i(this,"_totalPagesEl");i(this,"_requiredLegendEl",document.querySelector(".survey__required-description"));i(this,"_slideSurveyBtn",document.querySelector(".survey__tab"));i(this,"_modalWrapper");i(this,"changeToEndSurveyMode",()=>{_(this.nextBtn),h(this.submitBtn),this.skipValidation(),this.showTotalPages(u.currentPage),m==="disableButtons"&&setTimeout(()=>o.enableButtons(),0)});this.submitBtn=this._contentEl.querySelector(".survey__btn-submit"),this.nextBtn=this._contentEl.querySelector(".survey__btn-next"),this.previousBtn=this._contentEl.querySelector(".survey__btn-previous"),this.pagesWrapper=this._contentEl.querySelector(".survey__pages"),this._closeBtnEl=this._contentEl.querySelector(".survey__close-btn"),this._surveyWrapper=this._contentEl.querySelector(".survey__survey-wrapper"),this._formEl=this._contentEl.querySelector("form"),this._finalViewEl=this._contentEl.querySelector(".survey__final-view__wrapper"),this._currentPageEl=this._contentEl.querySelector(".survey__current-page"),this._totalPagesEl=this._contentEl.querySelector(".survey__total-pages"),this._modalWrapper=this._parentEl.closest(".modal-wrapper"),this._addCloseBtnHandler(),this._showSurvey(),this._mountQuestions(),this._setQuestionsPages(),g==="slide"&&this._showSlideBtn()}addSubmitHandler(e){this._formEl.addEventListener("submit",t=>{t.preventDefault(),e()})}paginate(){_(this._requiredLegendEl),this.visibleQuestions=[],this._allQuestionEls.forEach((e,t)=>{+e.dataset.page===u.currentPage?(h(e),this.visibleQuestions.push(t+1),e.querySelector("[required=true]")&&h(this._requiredLegendEl)):_(e)}),this._currentPageEl.innerText=u.currentPage+"",m==="disableButtons"&&o.checkValidity(u.currentPage)}showTotalPages(e){this._totalPagesEl.innerText=e+""}hideSurvey(){_(this._surveyWrapper)}showFinalView(){h(this._finalViewEl)}addNextPageHandler(e){this.nextBtn.addEventListener("click",()=>{e("next")})}addPreviousPageHandler(e){this.previousBtn.addEventListener("click",()=>{e("prev")})}addSlideSurveyBtnHandler(e){this._slideSurveyBtn.addEventListener("click",e)}toggleSurveyWrapper(){var e;(e=this._modalWrapper)==null||e.classList.toggle("survey__slide")}changeToNormalMode(e,t){A(e,t),this.bringBackValidation(),this.showTotalPages(e),m==="disableButtons"&&this.checkValidity(t)}checkValidity(e){return b(this,null,function*(){yield C(0);let n=this._allQuestionEls.filter(l=>+l.dataset.page===e).map(l=>{let c=l.querySelectorAll("input"),E=l.querySelectorAll("textarea"),T=l.querySelectorAll("select");return[...c,...E,...T]}).flatMap(l=>[...l].map(c=>c.checkValidity())).includes(!1);return m==="disableButtons"&&([...this.contentEl.querySelectorAll("input")].some(E=>E.checked&&E.dataset.endsSurvey==="true")?this.changeToEndSurveyMode():n?this.disableButtons():this.enableButtons()),n})}enableButtons(){[this.nextBtn,this.submitBtn].forEach(e=>e.removeAttribute("disabled"))}disableButtons(){[this.nextBtn,this.submitBtn].forEach(e=>e.setAttribute("disabled","true"))}get formData(){return new FormData(this._formEl)}skipValidation(){this.submitBtn.setAttribute("formnovalidate","true")}bringBackValidation(){this.submitBtn.removeAttribute("formnovalidate")}_showSlideBtn(){this._slideSurveyBtn.removeAttribute("style")}_setQuestionsPages(){this._allQuestionEls.forEach((e,t)=>{e.dataset.page=Math.ceil((t+1)/L)+""})}_mountQuestions(){I.forEach((e,t)=>{let n=e.type==="single"?new G(e,t+1):e.type==="multi"?new Y(e,t+1):e.type==="scale"?new z(e,t+1):e.type==="open"?new Z(e,t+1):e.type==="date"?new ee(e,t+1):null;n&&this._allQuestionEls.push(n.contentEl)})}_showSurvey(){h(this._parentEl)}_addCloseBtnHandler(){this._closeBtnEl.addEventListener("click",()=>{_(this._parentEl),this._contentEl.remove()})}addEndSurveyHandler(e){this._formEl.addEventListener("change",t=>{e(t.target)})}slideSurveyOut(){this._modalWrapper&&(this._modalWrapper.style.display="none",this._modalWrapper.classList.add("survey__slide"),setTimeout(()=>{var e;(e=this._modalWrapper)==null||e.removeAttribute("style")},450),setTimeout(()=>{var e;(e=this._modalWrapper)==null||e.classList.remove("modal-slide")},500))}}class q extends H{constructor(e,t,n){let l=v(y({},t),{answers:void 0,questionIndex:n,questionKey:n,questionDescription:w[t.type]});super(".survey__questions__list",e,l);i(this,"_question");i(this,"_questionIndex");i(this,"_answerEls",[]);i(this,"_answersContainer");i(this,"_inputEls",[]);i(this,"_customCheckboxEls",[]);i(this,"_errorTextEl");this._question=t,this._questionIndex=n,this._answersContainer=this._contentEl.querySelector(".survey__answers__list"),new $(this._contentEl,l,this._question.required),this._errorTextEl=this._contentEl.querySelector(".survey__error__text")}_addGenericErrorHandler(){this._answerEls.forEach((e,t)=>{let n=e instanceof HTMLInputElement?[e]:e.querySelectorAll("input");m==="flagRed"&&n.forEach(l=>{l.addEventListener("invalid",this._defaultErrorHandler.bind(this,e,l))})})}_defaultErrorHandler(e,t,n){n.preventDefault();let l=e.querySelector(".survey__answer__checkbox"),c=this._contentEl.querySelectorAll(".survey__answer__checkbox");t.type!=="text"&&(l==null||l.classList.add("survey__error__input")),t.classList.add("survey__error__input"),h(this._errorTextEl),["input","change"].forEach(E=>{t.addEventListener(E,()=>{_(this._errorTextEl),c.forEach(T=>T.classList.remove("survey__error__input")),t.classList.remove("survey__error__input")})}),this._moveToFirstPageWithError()}_moveToFirstPageWithError(){+this._contentEl.dataset.page<u.currentPage&&(u.currentPage=+this._contentEl.dataset.page,o.paginate(),A(u.totalPages,u.currentPage)),u.isScrolling||(this.contentEl.scrollIntoView({behavior:"smooth"}),u.isScrolling=!0,setTimeout(()=>{u.isScrolling=!1},2e3))}_addCheckValidityOnChangeHandler(){this._inputEls.forEach(e=>{e instanceof HTMLInputElement?["change","input"].forEach(t=>{e.addEventListener(t,()=>setTimeout(()=>o.checkValidity(u.currentPage),0))}):e.addEventListener("input",t=>{setTimeout(()=>o.checkValidity(u.currentPage),0)})})}_addChangeHandler(e){this._inputEls.forEach(t=>{t instanceof HTMLInputElement?t.addEventListener("change",n=>{n.target&&e(n.target)}):t.addEventListener("input",n=>{n.target&&e(n.target)})})}_addExtraElements(e){let t=e.contentEl.querySelectorAll("input"),n=e.contentEl.querySelector(".survey__answer__checkbox");this._answerEls.push(e.contentEl),this._inputEls.push(...t),n&&this._customCheckboxEls.push(n)}}class $ extends H{constructor(s,e,t){super(s,"survey__question__content__template",e);let n=s.querySelector(".survey__required-mark");t||n.remove()}_render(){this._parentEl.insertAdjacentElement("afterbegin",this._contentEl)}}class M extends H{constructor(e,t,n,l){super(e,t,n);i(this,"_inputEl");i(this,"_required");this._inputEl=this._contentEl.querySelector("input")||this._contentEl,this._required=l,this._setRequired()}_setRequired(){this._required?this._inputEl.setAttribute("required","true"):this._inputEl.removeAttribute("required")}}class O extends H{constructor(e,t,n){super(e,"survey__counter__template",{limit:t});i(this,"_inputEl");i(this,"_counterEl");this._inputEl=n,this._counterEl=this._contentEl.querySelector(".survey__counter--value"),this.addInputChangeHandler()}addInputChangeHandler(){this._inputEl.addEventListener("input",()=>{this._counterEl.textContent=this._inputEl.value.length+""})}}class B extends q{constructor(e,t,n){super(e,t,n);i(this,"_question");this._question=t,this._mountAnswers(),m==="disableButtons"&&this._addCheckValidityOnChangeHandler()}_mountAnswers(){(this._question.shuffleAnswers?F(this._question.answers):this._question.answers).forEach((t,n)=>{let l={answer:t,questionKey:this._questionIndex,answerKey:n+1},c=[this._answersContainer,v(y({},l),{i:n}),this._question.required,t.options],E=this._question.type==="single"?new U(...c):new J(...c);this._addExtraElements(E)})}}class k extends M{constructor(e,t,n,l,c){super(e,t,v(y({},n),{limit:c.limit,endsSurvey:JSON.stringify(c.endsSurvey)}),l);i(this,"_customInputWrapper");i(this,"_customInputEl");i(this,"_options");this._options=c,this._customInputWrapper=this._contentEl.querySelector(".survey__custom-input__wrapper"),this._customInputEl=this._contentEl.querySelector(".survey__custom-input"),c.isOpen?(_(this._customInputWrapper),this._mountCounter(),this._addCustomInputHandler()):this._removeCustomInputEl()}_addCustomInputHandler(){this._parentEl.addEventListener("click",()=>b(this,null,function*(){yield C(0);let e=this._contentEl.querySelector("input");if(e!=null&&e.checked)h(this._customInputWrapper),this._required&&setTimeout(()=>this._customInputEl.setAttribute("required","true"),0);else{_(this._customInputWrapper),this._customInputEl.removeAttribute("required"),this._customInputEl.value="";let t=new Event("input",{bubbles:!0});this._customInputEl.dispatchEvent(t)}}))}_removeCustomInputEl(){this._customInputEl.remove()}_mountCounter(){var e;new O(this._customInputWrapper,((e=this._options)==null?void 0:e.limit)||f,this._customInputEl)}}class G extends B{constructor(s,e){super("survey__question__template--single",s,e),this._question=s,this._addGenericErrorHandler()}}class U extends k{constructor(s,e,t,n){super(s,"survey__answer__template--single",{replaceObj:e},t,n)}}class Y extends B{constructor(s,e){super("survey__question__template--multi",s,e),this._question=s,this._addGenericErrorHandler(),this._addChangeHandler(this._customChangeHandler.bind(this))}_customChangeHandler(){if(!this._question.required)return;this._inputEls.some(e=>e==null?void 0:e.checked)?this._inputEls.forEach(e=>e==null?void 0:e.removeAttribute("required")):this._inputEls.forEach(e=>e==null?void 0:e.setAttribute("required","true"))}}class J extends k{constructor(s,e,t,n){super(s,"survey__answer__template--multi",{replaceObj:e},t,n)}}class z extends q{constructor(e,t){super("survey__question--scale__template",e,t);i(this,"_question");this._question=e,this._mountAnswers(),this._addGenericErrorHandler(),this._addChangeHandler(this._customChangeHandler.bind(this)),m==="disableButtons"&&this._addCheckValidityOnChangeHandler()}_mountAnswers(){let e=this._question.length||10;for(let t=0;t<e;t++){let n={questionKey:this._questionIndex,answerKey:t+1,limit:this._question.length},l=typeof this._question.required=="undefined"?!0:this._question.required,c=new X(this._answersContainer,n,l);this._addExtraElements(c)}}_customChangeHandler(e){this._inputEls.forEach((t,n)=>{n<+e.dataset.value?this._customCheckboxEls[n].classList.add("survey__answer--active"):this._customCheckboxEls[n].classList.remove("survey__answer--active")})}}class X extends M{constructor(s,e,t){super(s,"survey__answer__template--scale",e,t)}}class Z extends q{constructor(e,t){super("survey__question--open__template",e,t);i(this,"_textAreaEl");this._textAreaEl=this._contentEl.querySelector(".survey__answer textarea"),this._inputEls.push(this._textAreaEl),this._answerEls.push(this._textAreaEl),this._setRequired(),m==="flagRed"&&this._addCustomErrorHandler(),new O(this._contentEl,e.limit||f,this._textAreaEl),m==="disableButtons"&&this._addCheckValidityOnChangeHandler()}_addCustomErrorHandler(){this._contentEl.querySelector("textarea").addEventListener("invalid",t=>{t.preventDefault(),this._customErrorHandler()})}_customErrorHandler(){this._textAreaEl.classList.add("survey__error__input"),h(this._errorTextEl),this._textAreaEl.addEventListener("input",()=>{this._textAreaEl.value.trim()!==""?(_(this._errorTextEl),this._textAreaEl.classList.remove("survey__error__input")):(this._textAreaEl.classList.add("survey__error__input"),h(this._errorTextEl))}),this._moveToFirstPageWithError()}_setRequired(){(typeof this._question.required=="undefined"?!0:this._question.required)?this._textAreaEl.setAttribute("required","true"):this._textAreaEl.removeAttribute("required")}}class ee extends q{constructor(s,e){super("survey__question--date__template",s,e),this._question=s;let t=this._contentEl.querySelector(".survey__answer"),n=new te(t,v(y({},s),{questionKey:this._questionIndex}),s.required);this._inputEls.push(n.contentEl),this._answerEls.push(n.contentEl),this._addGenericErrorHandler(),m==="disableButtons"&&this._addCheckValidityOnChangeHandler()}}class te extends M{constructor(s,e,t){super(s,"survey__answer__template--date",e,t)}}let o=new K,P=()=>b(null,null,function*(){let r=yield j(o.visibleQuestions),s=v(y({},r),{step:u.currentPage});console.log(s)}),V=r=>b(null,null,function*(){if(r==="next"){if(yield o.checkValidity(u.currentPage))return;S&&P(),u.currentPage++}r==="prev"&&u.currentPage--,o.paginate(),A(u.totalPages,u.currentPage)}),A=(r,s)=>{r===1?(h(o.submitBtn),_(o.nextBtn),_(o.previousBtn),_(o.pagesWrapper)):r>1&&s===1?(_(o.submitBtn),h(o.nextBtn),_(o.previousBtn)):r>1&&s===r?(h(o.submitBtn),_(o.nextBtn),h(o.previousBtn)):(_(o.submitBtn),h(o.nextBtn),h(o.previousBtn))},j=r=>b(null,null,function*(){let s={surveyName:x};for(let[e,t]of o.formData.entries()){if(!t||r&&!r.some(l=>e.includes(l+"")))continue;document.querySelector(`[name="${e}"]`).type==="checkbox"?s[e]?s[e].push(t):s[e]=[t]:s[e]=t}for(let[e,t]of Object.entries(s))typeof t=="object"&&(s[e]=`${JSON.stringify(t)}`);return s}),se=()=>b(null,null,function*(){let r=yield j();o.hideSurvey(),o.showFinalView(),console.log(r),S&&P()}),ne=r=>{(r.dataset.endsSurvey==="true"&&!r.checked||r.type==="radio"&&r.dataset.endsSurvey==="false")&&o.changeToNormalMode(u.totalPages,u.currentPage)},re=()=>{o.toggleSurveyWrapper()};(()=>{o.addSubmitHandler(se),o.paginate(),o.showTotalPages(u.totalPages),A(u.totalPages,u.currentPage),o.addNextPageHandler(V),o.addPreviousPageHandler(V),o.addEndSurveyHandler(ne),g==="slide"&&(o.slideSurveyOut(),o.addSlideSurveyBtnHandler(re))})()}window.createSurvey=ce;})();
